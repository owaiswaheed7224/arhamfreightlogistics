<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="width=1024, initial-scale=0.5, minimum-scale=0.3, maximum=3, user-scalable=yes">
  <title>Shipment Booking - Arham Freight</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Select2 CSS (for searchable dropdowns) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  <style>
    body { background-color: #f5f7fa; font-family: Arial, sans-serif; }
    .sidebar { height: 100vh; width: 240px; position: fixed; top: 0; left: 0; background: #0d6efd; color: #fff; padding: 20px 15px; }
    .sidebar .logo-box { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 25px; border: 2px solid #ddd; text-align: center; }
    .sidebar .logo-box img { width: 100%; height: auto; object-fit: contain; }
    .sidebar a { display: block; padding: 12px 15px; margin: 5px 0; color: #fff; text-decoration: none; border-radius: 8px; transition: 0.3s; }
    .sidebar a:hover { background: #0b5ed7; }
    .navbar-custom { margin-left: 260px; background-color: #0d6efd; }
    .navbar-custom .navbar-brand { color: #fff; font-weight: bold; }
    .navbar-custom .nav-link, .navbar-custom .dropdown-toggle { color: #fff; }
    .navbar-custom .dropdown-menu { right: 0; left: auto; }
    .main-content { margin-left: 260px; padding: 20px; }
    form { width: 100%; margin: 0; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
    .section { margin-top: 20px; border: 1px solid #ddd; border-radius: 8px; padding: 15px; }
    .section h3 { background: #007bff; color: #fff; margin: -15px -15px 15px -15px; padding: 10px; border-radius: 8px 8px 0 0; font-size: 16px; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; }
    .form-actions { text-align: right; margin-top: 20px; }
    button { background: #007bff; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px; }
    button.cancel { background: #6c757d; }
    button:hover { opacity: 0.9; }
    .select2-container--default .select2-selection--single { height: calc(2.25rem + 2px); padding: 6px 12px; border-radius: 5px; border: 1px solid #ccc; }
    .select2-container .select2-selection--multiple { min-height: calc(2.25rem + 2px); border-radius: 5px; border: 1px solid #ccc; padding: 4px 8px; }
  </style>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo-box"><img src="Logo.png" alt="Company Logo"></div>
    <a href="dashboard.html">üè† Dashboard</a>
    <a href="booking.html" style="background:#0b5ed7;">üì¶ Shipment Booking</a>
    <a href="#">üîç Searching Booking</a>
    <a href="#">üöö Track Shipments</a>
    <a href="pending.html">‚è≥ Pending Signups</a>
    <a href="approved.html">‚úÖ Approved Signups</a>
    <a href="#">üí∞ Rate Inquiry</a>
    <a href="#">üìÉ Account List</a>
  </div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom shadow-sm fixed-top">
    <div class="container-fluid">
      <div class="mx-auto text-center">
        <a class="navbar-brand">üöö Arham Freight Logistics</a>
      </div>
      <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarMenu">
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">‚ò∞ Menu</a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="index.html">üö™ Logout</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content" style="margin-top:80px;">
    <h2 class="text-center mb-4">Shipment Booking Form</h2>

    <form id="bookingForm" method="POST"
      action="https://script.google.com/macros/s/AKfycbwfaqdFiy9_nDZ4ygiw8ht0JZH5nPztCJeaHiiexeDJH7XhZopoYup49LZ1YV2PyvPQ/exec">

      <div class="row">
        <!-- Shipper -->
        <div class="col-md-6">
          <div class="section">
            <h3>Shipper Details</h3>
            <label>Date</label>
            <input type="date" name="date" required>
            <label>AWB Number</label>
            <input type="text" name="awb_number" required>
            <label>Shipper Company</label>
            <input type="text" name="shipper_company">
            <label>Shipper Name</label>
            <input type="text" name="shipper_name">
            <label>Shipper Contact Number</label>
            <input type="tel" name="shipper_contact" placeholder="+92XXXXXXXXXX" required>
            <label>Ship Address 1</label>
            <input type="text" name="ship_address1">
            <label>Ship Address 2</label>
            <input type="text" name="ship_address2">
            <label>Ship City</label>
            <input type="text" name="ship_city">
            <label>Ship Country</label>
            <select class="form-control country-select" name="ship_country" required><option value=""></option></select>
            <label>Ship NTN</label>
            <input type="text" name="ship_ntn">
            <label>Ship NIC</label>
            <input type="text" name="ship_nic">
          </div>

          <!-- Services -->
          <div class="section">
            <h3>Services</h3>
            <label>Service</label>
            <select class="form-control service-select" name="service" required>
              <option value="Air Freight">Air Freight</option>
              <option value="Sea Freight">Sea Freight</option>
              <option value="Road Transport">Road Transport</option>
              <option value="Courier">Courier</option>
              <option value="Door to Door">Door to Door</option>
              <option value="Port to Port">Port to Port</option>
              <option value="Express">Express</option>
            </select>

            <label>Type</label>
            <select class="form-control" name="type" required>
              <option value="DOX">DOX</option>
              <option value="NON DOX">NON DOX</option>
            </select>
          </div>
        </div>

        <!-- Receiver -->
        <div class="col-md-6">
          <div class="section">
            <h3>Receiver Details</h3>
            <label>Receiver Company</label>
            <input type="text" name="receiver_company">
            <label>Receiver Attention</label>
            <input type="text" name="receiver_attention">
            <label>Receiver Contact Number</label>
            <input type="tel" name="receiver_contact" placeholder="+1XXXXXXXXXX" required>
            <label>Receiver Address 1</label>
            <input type="text" name="receiver_address1">
            <label>Receiver Address 2</label>
            <input type="text" name="receiver_address2">
            <label>Receiver ZIP Code</label>
            <input type="text" name="receiver_zip">
            <label>Receiver City</label>
            <input type="text" name="receiver_city">
            <label>Receiver Country</label>
            <select class="form-control country-select" name="receiver_country" required><option value=""></option></select>
          </div>
        </div>
      </div>

      <!-- Commercial Invoice (Collapsible Section Integrated) -->
      <!-- Commercial Invoice (Collapsible) -->
      <div class="section">
        <h3>
          <a class="btn btn-link text-white" data-bs-toggle="collapse" href="#invoiceSection" role="button" aria-expanded="false" aria-controls="invoiceSection">
            Commercial Invoice
          </a>
        </h3>
        <div class="collapse" id="invoiceSection">
          <table class="table table-bordered text-center align-middle" id="invoiceTable">
            <thead class="table-secondary">
              <tr>
                <th>Description</th>
                <th>Qty</th>
                <th>Unit</th>
                <th>Rate</</th>
                <th>Value</th>
                <th>‚ùå</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><textarea class="form-control desc" name="description[]"></textarea></td>
                <td><input type="number" class="form-control qty" name="qty[]" value="0"></td>
                <td><input type="text" class="form-control unit" name="unit[]" placeholder="pcs"></td>
                <td><input type="number" step="0.01" class="form-control rate" name="rate[]" value="0"></td>
                <td><input type="number" step="0.01" class="form-control value" name="value[]" readonly></td>
                <td><button type="button" class="btn btn-danger btn-sm deleteRow">üóë</button></td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="6" class="text-start">
                  <button type="button" class="btn btn-primary btn-sm" id="addRow">‚ûï Add</button>
                </td>
              </tr>
              <tr>
                <td class="fw-bold text-end">TOTAL</td>
                <td><input type="number" class="form-control" id="totalQty" readonly></td>
                <td></td>
                <td></td>
                <td><input type="number" class="form-control" id="totalValue" readonly></td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <!-- Charges Section -->
      <div class="section">
        <h3>Charges</h3>
        <label>Pieces</label>
        <input type="number" name="pieces">
        <label>Weight</label>
        <input type="number" step="0.01" name="weight">
        <label>Charge Weight</label>
        <input type="number" step="0.01" name="chrg_weight">
        <label>Dim Weight</label>
        <input type="number" step="0.01" name="dim_weight">
        <label>Payable</label>
        <input type="number" step="0.01" name="payable">
        <label>Total</label>
        <input type="number" step="0.01" name="total">
        <label>Balance</label>
        <input type="number" step="0.01" name="balance">
      </div>

      <div class="form-actions">
        <button type="button" class="cancel" onclick="document.getElementById('bookingForm').reset();">Cancel Booking</button>
        <button type="submit">Submit Booking</button>
      </div>
    </form>
  </div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const countries = [...]; // same list as before

    $(document).ready(function () {
      $(".country-select").each(function () {
        const $sel = $(this);
        countries.forEach(c => { $sel.append(new Option(c, c)); });
      });

      $(".country-select").select2({ placeholder: "Select country", allowClear: true, width: '100%' });
      $(".service-select").select2({ placeholder: "Select or type service", tags: true, tokenSeparators: [','], width: '100%' });

      // Form submission
      $("#bookingForm").submit(function (e) {
        e.preventDefault();
        var $form = $(this);
        $.ajax({
          url: $form.attr('action'),
          method: 'POST',
          data: $form.serialize(),
          success: function () {
            alert("‚úÖ Booking Submitted Successfully!");
            $form[0].reset();
            $(".country-select, .service-select").val(null).trigger('change');
          },
          error: function () { alert("‚ùå Submission failed. Try again."); }
        });
      });
    });

    // Commercial Invoice Functions
    function calculateRow(row) {
      let qty = parseFloat(row.find(".qty").val()) || 0;
      let rate = parseFloat(row.find(".rate").val()) || 0;
      row.find(".value").val((qty * rate).toFixed(2));
      calculateTotals();
    }

    function calculateTotals() {
      let totalQty = 0, totalValue = 0;
      $("#invoiceTable tbody tr").each(function () {
        let qty = parseFloat($(this).find(".qty").val()) || 0;
        let val = parseFloat($(this).find(".value").val()) || 0;
        totalQty += qty;
        totalValue += val;
      });
      $("#totalQty").val(totalQty);
      $("#totalValue").val(totalValue.toFixed(2));
    }

    $(document).on("input", ".qty, .rate", function () {
      calculateRow($(this).closest("tr"));
    });

    $(document).on("click", "#addRow", function () {
      let newRow = `<tr>
        <td><textarea class="form-control desc" name="description[]"></textarea></td>
        <td><input type="number" class="form-control qty" name="qty[]" value="0"></td>
        <td><input type="text" class="form-control unit" name="unit[]" placeholder="pcs"></td>
        <td><input type="number" step="0.01" class="form-control rate" name="rate[]" value="0"></td>
        <td><input type="number" step="0.01" class="form-control value" name="value[]" readonly></td>
        <td><button type="button" class="btn btn-danger btn-sm deleteRow">üóë</button></td>
      </tr>`;
      $("#invoiceTable tbody").append(newRow);
    });

    $(document).on("click", ".deleteRow", function () {
      $(this).closest("tr").remove();
      calculateTotals();
    });
  </script>
</body>
</html>
